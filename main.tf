// Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.

module "load_balancer" {
  source                          = "modules/terraform-oci-load-balancer"
  compartment_id                  = "${var.compartment_ocid}"
  display_name                    = "${var.display_name_prefix}_${var.display_name}"
  shape                           = "${var.shape}"
  is_private                      = "${var.is_private}"
  subnet_ids                      = ["${oci_core_subnet.lb.*.id}"]
  backendset_name                 = "${var.display_name_prefix}_${var.backendset_name}"
  backendset_policy               = "${var.backendset_policy}"
  hc_protocol                     = "${var.hc_protocol}"
  hc_port                         = "${var.hc_port}"
  hc_response_body_regex          = "${var.hc_response_body_regex}"
  hc_url_path                     = "${var.hc_url_path}"
  backend_count                   = "${var.backend_count}"
  backend_ips                     = ["${oci_core_instance.servers.*.private_ip}"]
  backend_ports                   = "${var.backend_ports}"
  path_route_set_name             = "${var.path_route_set_name}"
  path                            = "${var.path}"
  path_match_type                 = "${var.path_match_type}"
  hostnames                       = "${var.hostnames}"
  hostname_names                  = "${var.hostname_names}"
  listener_certificate_name       = "${var.listener_certificate_name}"
  listener_ca_certificate         = "${var.listener_ca_certificate}"
  listener_private_key            = "${var.listener_private_key}"
  listener_public_certificate     = "${var.listener_public_certificate}"
  listener_protocol               = "${var.listener_protocol}"
  ssl_listener_name               = "${var.ssl_listener_name}"
  ssl_listener_port               = "${var.ssl_listener_port}"
  ssl_verify_peer_certificate     = "${var.ssl_verify_peer_certificate}"
  ssl_verify_depth                = "${var.ssl_verify_depth}"
  ssl_listener_hostnames          = "${var.ssl_listener_hostnames}"
  ssl_listener_path_route_set     = "${var.ssl_listener_path_route_set}"
  non_ssl_listener_name           = "${var.non_ssl_listener_name}"
  non_ssl_listener_port           = "${var.non_ssl_listener_port}"
  non_ssl_listener_hostnames      = "${var.non_ssl_listener_hostnames}"
  non_ssl_listener_path_route_set = "${var.non_ssl_listener_path_route_set}"
}
